{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<style>
.lesson-page-container {
    padding: 1rem;
    margin-top: -1rem;  /* Move the container up */
}

.lesson-header {
    margin-bottom: 1.5rem;
    position: relative;
    background-color: #4343f4;
    border-radius: 25px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.lesson-header h1 {
    color: #fff;
    font-size: 2rem;
    font-weight: 500;
    margin: 0;
    padding: 0;
}

.lesson-header .back-to-list {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    text-decoration: none;
    font-weight: 500;
    transition: opacity 0.3s ease;
}

.lesson-header .back-to-list:hover {
    opacity: 0.8;
    text-decoration: none;
    color: white;
}

.lesson-content {
    padding: 1rem;
    background-color: transparent;
    border-radius: 12px;
    margin: 0 auto;
    max-width: 1000px;
}

.video-container {
    position: relative;
    width: 100% !important;
    max-width: 800px !important;
    margin: 0 auto 2rem auto !important;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: transparent;
    padding: 0;
    border-radius: 12px;
    overflow: hidden;
}

.video-container video {
    width: 100% !important;
    max-width: 800px !important;
    height: auto !important;
    display: block;
    background-color: #000;
    border-radius: 8px;
    aspect-ratio: 16/9;
    object-fit: cover;
}

.video-title {
    position: relative;
    margin-top: 1.5rem;
    font-size: 3.5rem;
    font-weight: bold;
    color: #1a237e;
    background: rgba(255, 255, 255, 0.95);
    padding: 0.8rem 2.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    text-align: center;
    min-width: 120px;
    transition: all 0.3s ease;
    z-index: 10;
}

.video-subtitle {
    margin-top: 0.5rem;
    font-size: 1.2rem;
    color: #666;
    text-align: center;
    padding: 0.5rem 1rem;
    background: transparent;
    border-radius: 8px;
}

.video-title:hover {
    background: #fff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .lesson-page-container {
        padding: 0.5rem;
        margin-top: -0.5rem;  /* Slightly less negative margin for mobile */
    }
    
    .video-container {
        margin-bottom: 2rem;
    }
    
    .video-title {
        font-size: 2.5rem;
        padding: 0.6rem 1.8rem;
        min-width: 100px;
        margin-top: 1rem;
    }
}

@media (max-width: 480px) {
    .video-title {
        font-size: 2rem;
        padding: 0.5rem 1.5rem;
    }
}

.lesson-navigation {
    margin-top: -20px;
    padding: 0 20px;
}

.letter-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    gap: 10px;
}

.nav-btn {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    background-color: #4343f4;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 500;
    border: none;
    outline: none;
}

.nav-btn:hover, .nav-btn:focus {
    background-color: #3535d4;
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
    outline: none;
}

.nav-arrow {
    margin: 0 8px;
}

.prev-letter-btn {
    margin-right: auto;
}

.next-letter-btn {
    margin-left: auto;
}

.next-lesson-container {
    display: inline-flex;
    margin: 0;
}

.next-lesson-btn {
    background-color: #502387;
    margin-left: auto;
}

.next-lesson-btn:hover, .next-lesson-btn:focus {
    background-color: #6d2da1;
}

.practice-btn {
    background-color: #4a90e2;  /* Light blue color */
}

.practice-btn:hover, .practice-btn:focus {
    background-color: #357abd;  /* Slightly darker blue on hover */
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
    outline: none;
}
</style>

<div class="lesson-page-container">
    <div class="lesson-header">
        {% if chapter == 1 %}
            <h1>Alphabet Signs - Lesson {{ lesson }}</h1>
        {% elif chapter == 2 %}
            <h1>Numbers Signs</h1>
        {% elif chapter == 3 %}
            <h1>Common Words</h1>
        {% elif chapter == 4 %}
            <h1>Daily Communication</h1>
        {% endif %}
    </div>
    <div class="lesson-content">
        {% if chapter == 1 %}
            <div class="video-container">
                <video controls width="100%" autoplay loop muted>
                    {% if lesson == 1 %}
                        <source src="{% static 'videos/videos/ا.mp4' %}" type="video/mp4">
                    {% elif lesson == 2 %}
                        <source src="{% static 'videos/videos/د.mp4' %}" type="video/mp4">
                    {% elif lesson == 3 %}
                        <source src="{% static 'videos/videos/ض.mp4' %}" type="video/mp4">
                    {% elif lesson == 4 %}
                        <source src="{% static 'videos/videos/ك.mp4' %}" type="video/mp4">
                    {% endif %}
                    Your browser does not support the video tag.
                </video>
                <div class="video-title">
                    {% if lesson == 1 %}
                        ا
                    {% elif lesson == 2 %}
                        د
                    {% elif lesson == 3 %}
                        ض
                    {% elif lesson == 4 %}
                        ك
                    {% endif %}
                </div>
                <div class="video-subtitle" id="videoSubtitle">
                    Loading...
                </div>
            </div>
        {% elif chapter == 2 %}
            <div class="video-container">
                <video controls width="100%" autoplay loop muted>
                    <source src="{% static 'videos/videos/د.mp4' %}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-title">د</div>
            </div>
            <div class="lesson-text">
                <h2>Learning the Numbers in Sign Language</h2>
                <p>In this lesson, we will learn how to sign numbers</p>
            </div>
        {% elif chapter == 3 %}
            <div class="video-container">
                <video controls width="100%" autoplay loop muted>
                    <source src="{% static 'videos/videos/ض.mp4' %}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-title">ض</div>
            </div>
            <div class="lesson-text">
                <h2>Learning Common Words in Sign Language</h2>
                <p>In this lesson, we will learn how to sign common words</p>
            </div>
        {% elif chapter == 4 %}
            <div class="video-container">
                <video controls width="100%" autoplay loop muted>
                    <source src="{% static 'videos/videos/ك.mp4' %}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-title">ك</div>
            </div>
            <div class="lesson-text">
                <h2>Learning Daily Communication in Sign Language</h2>
                <p>In this lesson, we will learn how to sign daily communication phrases</p>
            </div>
        {% endif %}
    </div>

    <!-- Navigation -->
    <div class="lesson-navigation">
        {% if chapter == 1 %}
            <div class="letter-navigation">
                <a href="#" class="nav-btn prev-letter-btn" style="display: none;">
                    <span class="nav-arrow">←</span>
                    Previous Letter
                </a>
                <a href="#" class="nav-btn practice-btn" id="practice-btn">
                    Practice Letter
                </a>
                <a href="#" class="nav-btn next-letter-btn">
                    Next Letter
                    <span class="nav-arrow">→</span>
                </a>
                {% if lesson < 4 %}
                <a href="{% url 'lesson_view' chapter=chapter lesson=lesson|add:'1' %}" class="nav-btn next-lesson-btn" style="display: none;">
                    Next Lesson
                    <span class="nav-arrow">→</span>
                </a>
                {% else %}
                <a href="{% url 'quiz_question' question_number=1 %}" class="nav-btn next-lesson-btn" style="display: none;">
                    Take Quiz
                    <span class="nav-arrow">→</span>
                </a>
                {% endif %}
            </div>
        {% else %}
            <div class="letter-navigation">
                {% if lesson > 1 %}
                    <a href="{% url 'lesson_view' chapter=chapter lesson=lesson|add:'-1' %}" class="nav-btn prev-btn">
                        <span class="nav-arrow">←</span>
                        Previous Lesson
                    </a>
                {% endif %}
                
                {% if lesson < 4 %}
                    <a href="{% url 'lesson_view' chapter=chapter lesson=lesson|add:'1' %}" class="nav-btn next-btn">
                        Next Lesson
                        <span class="nav-arrow">→</span>
                    </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const videoElement = document.querySelector('.video-container video');
    const videoTitle = document.querySelector('.video-title');
    const videoSubtitle = document.getElementById('videoSubtitle');
    const prevLetterBtn = document.querySelector('.prev-letter-btn');
    const nextLetterBtn = document.querySelector('.next-letter-btn');
    const nextLessonBtn = document.querySelector('.next-lesson-btn');
    const practiceBtn = document.getElementById('practice-btn');
    let currentVideoIndex = 0;
    const currentLesson = parseInt("{{ lesson }}");
    const lessonVideos = {
        1: [
            { src: "{% static 'videos/videos/ا.mp4' %}", title: "ا", position: "First" },
            { src: "{% static 'videos/videos/ب.mp4' %}", title: "ب", position: "Second" },
            { src: "{% static 'videos/videos/ت.mp4' %}", title: "ت", position: "Third" },
            { src: "{% static 'videos/videos/ث.mp4' %}", title: "ث", position: "Fourth" },
            { src: "{% static 'videos/videos/ج.mp4' %}", title: "ج", position: "Fifth" },
            { src: "{% static 'videos/videos/ح.mp4' %}", title: "ح", position: "Sixth" },
            { src: "{% static 'videos/videos/خ.mp4' %}", title: "خ", position: "Seventh" }
        ],
        2: [
            { src: "{% static 'videos/videos/د.mp4' %}", title: "د", position: "Eighth" },
            { src: "{% static 'videos/videos/ذ.mp4' %}", title: "ذ", position: "Ninth" },
            { src: "{% static 'videos/videos/ر.mp4' %}", title: "ر", position: "Tenth" },
            { src: "{% static 'videos/videos/ز.mp4' %}", title: "ز", position: "Eleventh" },
            { src: "{% static 'videos/videos/س.mp4' %}", title: "س", position: "Twelfth" },
            { src: "{% static 'videos/videos/ش.mp4' %}", title: "ش", position: "Thirteenth" },
            { src: "{% static 'videos/videos/ص.mp4' %}", title: "ص", position: "Fourteenth" }
        ],
        3: [
            { src: "{% static 'videos/videos/ض.mp4' %}", title: "ض", position: "Fifteenth" },
            { src: "{% static 'videos/videos/ط.mp4' %}", title: "ط", position: "Sixteenth" },
            { src: "{% static 'videos/videos/ظ.mp4' %}", title: "ظ", position: "Seventeenth" },
            { src: "{% static 'videos/videos/ع.mp4' %}", title: "ع", position: "Eighteenth" },
            { src: "{% static 'videos/videos/غ.mp4' %}", title: "غ", position: "Nineteenth" },
            { src: "{% static 'videos/videos/ف.mp4' %}", title: "ف", position: "Twentieth" },
            { src: "{% static 'videos/videos/ق.mp4' %}", title: "ق", position: "Twenty-first" }
        ],
        4: [
            { src: "{% static 'videos/videos/ك.mp4' %}", title: "ك", position: "Twenty-second" },
            { src: "{% static 'videos/videos/ل.mp4' %}", title: "ل", position: "Twenty-third" },
            { src: "{% static 'videos/videos/م.mp4' %}", title: "م", position: "Twenty-fourth" },
            { src: "{% static 'videos/videos/ن.mp4' %}", title: "ن", position: "Twenty-fifth" },
            { src: "{% static 'videos/videos/ه.mp4' %}", title: "ه", position: "Twenty-sixth" },
            { src: "{% static 'videos/videos/و.mp4' %}", title: "و", position: "Twenty-seventh" },
            { src: "{% static 'videos/videos/ي.mp4' %}", title: "ي", position: "Twenty-eighth" }
        ]
    };
    let videos = lessonVideos[currentLesson] || [];

    function updateVideo(video) {
        if (!video) return;
        videoElement.src = video.src;
        videoTitle.textContent = video.title;
        videoSubtitle.textContent = `${video.position} letter of the Arabic alphabet`;
        videoElement.load();
        videoElement.play();
        // Update practice button URL with the correct letter
        const letterUrl = "{% url 'letter_detail' letter='PLACEHOLDER' %}".replace('PLACEHOLDER', video.title);
        practiceBtn.href = letterUrl;
        // Update navigation buttons
        prevLetterBtn.style.display = currentVideoIndex > 0 ? 'flex' : 'none';
        nextLetterBtn.style.display = currentVideoIndex < videos.length - 1 ? 'flex' : 'none';
        if (currentVideoIndex === videos.length - 1) {
            if (nextLessonBtn) nextLessonBtn.style.display = 'flex';
        } else {
            if (nextLessonBtn) nextLessonBtn.style.display = 'none';
        }
    }

    // Check if we need to scroll to a specific letter
    const scrollToLetter = localStorage.getItem('scrollToLetter');
    if (scrollToLetter) {
        const videoIndex = videos.findIndex(v => v.title === scrollToLetter);
        if (videoIndex !== -1) {
            currentVideoIndex = videoIndex;
            updateVideo(videos[currentVideoIndex]);
            localStorage.removeItem('scrollToLetter');
        }
    } else {
        if (videos.length > 0) {
            updateVideo(videos[0]);
        }
    }

    // Event listeners for navigation buttons
    prevLetterBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (currentVideoIndex > 0) {
            currentVideoIndex--;
            updateVideo(videos[currentVideoIndex]);
        }
    });

    nextLetterBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (currentVideoIndex < videos.length - 1) {
            currentVideoIndex++;
            updateVideo(videos[currentVideoIndex]);
        }
    });
});
</script>
{% endblock %} 